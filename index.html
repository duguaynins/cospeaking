

<!DOCTYPE html>
<html lang="en">
<head translate="yes">
  <meta charset="UTF-8">
  <link rel="icon" type="image/x-icon" sizes="48x48" href="data:image/x-icon;base64,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">
  <!--link rel="icon" type="image/x-icon" sizes="48x48" href="https://duguaynins-allninsone.hf.space/favicon.ico"-->
  <!--link rel="icon" type="image/png" sizes="48x48" href="/favicon.png"-->
  <!--link rel="shortcut icon" href="/favicon.ico"-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="description" content="Â© 2024 NINS (by JPGT). By using any of the services, it means you have agreed to any content and all content!">
    <link rel="canonical" href="https://copyright.nins.cc/">
  <title translate="no">nins/cospeaking</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    body {
      overflow: hidden;
    }
  </style>
  <style>
    #content {
        display: flex;
        flex-direction: column;
        justify-content: center;  /* å‚ç›´ç½®ä¸­ */
        align-items: center;      /* æ°´å¹³ç½®ä¸­ */
        text-align: center;       /* æ–‡å­—ç½®ä¸­ */
    }
    input, textarea, button, select {
      /*font-size: inherit; /* ä¸»å‹•ç¹¼æ‰¿ body å­—é«”å¤§å° */
      font-size: 18px;
    }
    html, body { font-size: 14px; }
    html, body {
      margin: 0;
      padding: 0;
      /*font-family: Arial, sans-serif;*/
      background-color: #ffffff;
      background-color: #000000;
      background-color: #cdcdcd;
      color: #333;
      user-select: none;
    }

    header {
      text-align: center;
      padding: 2rem 1rem;
      border-bottom: 1px solid #ddd;
    }

    header h1 {
      margin: 0;
      font-size: 2.5rem;
    }

    .intro {
      text-align: center;
      padding: 1rem 2rem;
      max-width: 700px;
      margin: auto;
    }
  </style>
  
  <style>
  
    @keyframes blink {
      0% { border-color: black; }
      50% { border-color: transparent; }
      100% { border-color: black; }
    }
    
    #BOTTOM {
        height: 100vh;  /* è¦–çª—é«˜åº¦å¯æ”¹æˆä½ éœ€è¦çš„é«˜åº¦ */
        width: 100vw;
        background-color: #000000;
        background-color: #cdcdcd;
        color: #333;
    }
    .container {
      position: relative;  /* çˆ¶å®¹å™¨è¨­å®šç‚º relativeï¼Œä»¥ä¾¿å­å…ƒç´ çš„ absolute å®šä½èƒ½ç›¸å°æ–¼å®ƒ */
      width: 100%;
      height: 100%;
      background: #eee;
      color: black;
    }
  </style>
  <style>
      .skiptranslate {
        display: none !important;   /* é¿å… display:none å½±éŸ¿å…§å®¹é¡¯ç¤º */
        position: static !important;   /* é˜²æ­¢ä½ç½®ç•°å¸¸ */
        width: 0px !important;
        height: 0px !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        background: none !important;
        /*font-size: inherit !important;*/
      }
      iframe {
        display: none !important;
      }
  </style>

  <style>
    @keyframes fadeGradient {
      from {
        background: linear-gradient(white, white);
      }
      to {
        background: linear-gradient(white, transparent);
      }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    
    @keyframes hardBlink {
      0%, 100% { border-color: red; }
      50%      { border-color: transparent; }
    }
    .main {
        border: 2px solid red;
        padding: 8px;
        /**animation: blinkBorder 1s infinite;  //===*/
        /* å‘¼å¸å¼å‹•ç•«ï¼šå¹³æ»‘éæ¸¡ */
        /**animation: blinkBorder 1s ease-in-out infinite;  //===*/
        /* é–ƒçˆå¼å‹•ç•«ï¼šç¬é–“åˆ‡æ› */
        animation: hardBlink 1.0s steps(1, start) infinite;
    }
    
    input:hover {
      background-color: #cdcdcd;
      color: black;
    }
    input:active {
      background-color: #222222;
      color: white;
    }
    input:focus {
      outline: none;              /* ç§»é™¤é è¨­è—è‰²é‚Šæ¡† */
      /* border: 2px solid #4CAF50;  æ”¹ç‚ºç¶ è‰²é‚Šæ¡† */
      /* box-shadow: 0 0 5px #4CAF50; */
      border: 2px solid red;       /* æˆ–ä½¿ç”¨ #f44336 */
      box-shadow: 0 0 5px red;
    }
  </style>
  <style>
    .hotkey > * {
      flex:1;
      margin: 0;         /* é¿å…é¡å¤–é–“è· */
    }
  </style>
</head>
<body>
    <div id="google_translate_element" style="display:none;"></div>
  
    
    <button disabled="" id="disabled" style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      margin: 0;
      /*opacity: 0;  /*ä¸é€æ˜åº¦*/
      /*background: transparent;  /*ä¸é€æ˜åº¦ï¼Ÿ*/
      cursor: default;
      z-index: 99999;  /* ç¢ºä¿åœ¨æœ€é«˜å±¤ */
      /*background: linear-gradient(white, transparent);*/
      background: white;
      animation: fadeOut 3s forwards;
      pointer-events: none;  /* å‹•ç•«æœŸé–“ä¸é˜»æ“‹äº’å‹•ï¼ˆå¯é¸ï¼‰*/
    "></button>
    
    
    <div style="
      position: fixed;
      bottom: 0;
      top: 0; /* è·é›¢é ‚éƒ¨ 0 */
      left: 0; /* è·é›¢å·¦å´ 0 */
      right: 0; /* è·é›¢å³å´ 0 */
      background: #777777;
      background: #FF3B00;
      background: white;
      color: white;
      text-align: center;
      /*padding: 10px;*/
      box-sizing: border-box;
      word-break: break-word;
      z-index: 9998;
      
      display: flex;
      flex-direction: column;
    ">
          <strong id="anything" style="background-color: black; color: white; font-size: max(1vh,1vw);"><b translate="no">Â© nins. </b>I will accompany you, whether you are speaking.</strong>
          <div style="background: #FFFFFF; color: black;" translate="no">
          <div style="height: 2vh; margin: 10px;" onclick="document.getElementById('DialogCheck').showModal();console.log(new Date().toLocaleString(), 'ğŸ™‰');">
          nins/cospeaking
          </div></div>
          <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->
          <select translate="no" id="voiceSelect" style="width: 100vw; display: none;"></select>
          <select translate="no" id="voiceSelect1" style="width: 100vw; background-color: #EEE;"></select>
          <select translate="no" id="voiceSelect2" style="width: 100vw; background-color: #DDD;"></select>
          <input type="range" id="rateSlider" min="0.5" max="2.0" step="0.1" value="1.2" style="width: 100vw; box-sizing: border-box; padding: 0; margin: 0;">
          
          <div id="content" style="background: #FFFFFF; width: 100%; flex:1; border: 1px solid #ccc;">





  <canvas id="pdfCanvas" style="display: none; max-height: 58vh; height: auto;
                                max-width: 100vw; width: auto; 
                                padding: 0px; margin: 0px;"></canvas>
  <span id="pageInfo" style="display: block; color: #000;">
    <br>
    <h1 translate="no" style="margin: 0;">Â© 2024 NINS. ğŸ‘»</h1>
    <p translate="no" style="margin: 0; color: red;">(by JPGT)</p>
    <!--p>ğŸ“Œ I will accompany you during your speak. ğŸ•›</p-->
    <p><span translate="no"> ğŸ“Œ </span>I will accompany you, whether you are speaking.</p>
    <!--p>ğŸ’¡ Each line of the text file will be compiled into a playlist.</p-->
    <p><span translate="no"> ğŸ’¡ </span>Each line in the text file will be compiled individually, and then merged into a single playlist.</p>
    <p><span translate="no"> ğŸ’¡ </span>If you donâ€™t know how to use it, just press all the buttons once and it will work!</p>
    <!--p>1ï¸âƒ£ is to select the report file, 2ï¸âƒ£ is to select the text file.</p-->
    <p><span translate="no"> 1ï¸âƒ£ </span>Select the PDF file,<span translate="no"> 2ï¸âƒ£ </span>Select the TXT file...</p>
    <p>ğŸ”»ğŸ”»ğŸ”»</p>
    <!--p>ğŸ„â˜ƒï¸ğŸ¦Œâœ¨â­</p-->
  </span>

<!--textarea id="txt" placeholder="åœ¨æ­¤è¼¸å…¥è¦è½‰èªéŸ³çš„æ–‡å­—..."></textarea-->




          </div>
          

          <!--input type="file" id="fileInputPdf" accept=".pdf" style="display:none;"-->
          <!--input type="file" id="fileInputTxt" accept=".txt" style="display:none;"-->
          <!--input type="file" id="fileInputPdf" accept="application/pdf" style="display:none;"-->
          <!--input type="file" id="fileInputTxt" accept="text/plain" style="display:none;"-->
          <input type="file" id="fileInputPdf" accept="" style="display:none;">
          <input type="file" id="fileInputTxt" accept="" style="display:none;">


          <div class="hotkey" translate="no" style="display: flex; margin: 0vw; display: flex; flex-direction: row; border: 2px solid #cdcdcd; animation: hardBlink 1.0s steps(1, start) infinite;" translate="no">
              <button id="fileInputPdfRow" class="custom-btn" style="background:#77ff77; color: #000000;" onclick="document.getElementById('fileInputPdf').click()">
                1ï¸âƒ£<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">PDF</p></button>
              <button id="fileInputTxtRow" class="custom-btn" style="background:#77ff77; color: #000000;" onclick="document.getElementById('fileInputTxt').click()">
                2ï¸âƒ£<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">TXT</p></button>
            
              <button id="prevAllBtn">â®ï¸<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Previous</p></button>
              <button id="nextAllBtn">â­ï¸<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Next</p></button>
              <button id="speakBtn">â–¶ï¸<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Play</p></button>
              <button id="stopBtn">â¸ï¸<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">Stop</p></button>

              <button id="fullscreenBtn" disabled="">ğŸ‘€<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">fullscreen</p></button>
              <button id="switchinputBtn" disabled="">ğŸ’¬<p style="margin: 0; padding: 0; font-size: 1vh;" class="label">switchinput</p></button>
              
          </div>
          <input class="" id="txt" type="text" name="noMemory" autocomplete="off" placeholder="After uploading two files, start!" style="width: 100%; text-align: center; display: none;"/>
          
          <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->
          <!--strong>â®ï¸â­ï¸â–¶ï¸â¸ï¸ğŸ’¬ğŸ‘€ğŸ–µ</strong-->
          <div style="background: #FF3B00; color: white;" translate="yes">
          <div style="margin: 10px;" onclick="document.getElementById('DialogTool').showModal()">
          By sending a message to this service, it means you have agreed to any content and all content!
          </div></div>
          <strong style="background-color: black; color: white; font-size: max(1vh,1vw);" translate="no">Â© 2024 NINS (by JPGT).</strong>
    </div>
    
    <dialog id="DialogCheck" translate="no">
        <pre id="logOutput" style="max-height:200px; overflow:auto; margin:0;"></pre>
        <br>
        <button id="openLog" style="width: 100%;" onclick="document.getElementById('DialogCheck').close();console.log(new Date().toLocaleString(), 'ğŸ™ˆ');">âŒ</button>

    </dialog>
<!-- HTML ================================================== -->

<script>
const dialog = document.getElementById('DialogCheck');
const logOutput = document.getElementById('logOutput');
/*
const _log = console.log;
console.log = function(...args) {
  _log.apply(console, args);

  const text = args.map(a =>
    typeof a === 'object' ? JSON.stringify(a) : String(a)
  ).join(' ');

  logOutput.insertAdjacentHTML('beforeend', text + '\n');
  logOutput.scrollTop = logOutput.scrollHeight; // âœ… è‡ªå‹•æ»¾åˆ°åº•
}; */

// æ””æˆª console.log èˆ‡ console.error
['log', 'error'].forEach(level => {
  const original = console[level];
  console[level] = function(...args) {
    original.apply(console, args);
    const message = args.map(a => (typeof a === 'object' ? JSON.stringify(a) : a)).join(' ');
    logOutput.insertAdjacentHTML('beforeend', `<div class="${level}">${message}</div>`);
    // æ»¾å‹•åˆ°åº•éƒ¨
    logOutput.scrollTop = logOutput.scrollHeight;
  };
});

// æ¸¬è©¦
const version = (new Date().toLocaleString(), 'v1.20251203.1315 (This is an error test.)');
console.error(version);
console.warn(version);
console.info(version);
console.log(version);
</script>
<!-- LOG ================================================== -->
    







    <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->

<script>
document.getElementById('fileInputPdf').addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = async function() {
    const typedarray = new Uint8Array(this.result);
    const pdf = await pdfjsLib.getDocument(typedarray).promise;
    let resultText = '';

    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const pageText = content.items.map(item => item.str).join(' ').trim();
      
      // åŠ ä¸Šé ç¢¼æ ¼å¼
      ///const pageNumber = String(i).padStart(2, '0');  ///01~99
      ///const pageNumber = String(i).padStart(3, '0');  ///001~999
      const pageNumber = String(i).padStart(4, '0');  ///0001~9999
      resultText += `[${pageNumber}]â–¶ï¸ã€€${pageText}\n\n`;
    }

    // è‡ªå‹•ä¸‹è¼‰ TXT
    const blob = new Blob([resultText], {type: 'text/plain;charset=utf-8'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = file.name.replace(/\.pdf$/i, '.txt');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
  };
  reader.readAsArrayBuffer(file);
});
</script>

<script>
/* --- TOUCH åŠŸèƒ½ --- */
// å…¨è¢å¹•ç•«å¸ƒ
const carousel = document.getElementById('pdfCanvas');
let startX = 0;
let isDragging = false;

// æ”¶æ”¾è¼¸å…¥æ¡†
document.getElementById('switchinputBtn').addEventListener('click', () => {
  if (document.getElementById('txt').style.display === 'none') {
    document.getElementById('txt').style.display = 'block'; // é¡¯ç¤ºå…ƒç´ 
  } else {
    document.getElementById('txt').style.display = 'none';  // éš±è—å…ƒç´ 
  }
});

// æ§åˆ¶æ–¹æ³•çµ±ä¸€
function contrlRight() {
    if(!pdfDoc) return;
    if (currentPage === totalPages) {
      console.log("Already on the last page");
      return;  // é é¢èªéŸ³åŒæ­¥
    }
    ///if(currentPage < totalPages){ currentPage++; renderPage(currentPage); }
    console.log("â­ï¸", currentPage, currentPage+1);
    goToPage(currentPage + 1);
    
    if(lines.length===0) return;
    currentIndex = (currentIndex +1) % lines.length;
    txt.value = lines[currentIndex];
}
function contrlLeft() {
    if(!pdfDoc) return;
    if (currentPage === 1) {
      console.log("Already on the first page");
      return;  // é é¢èªéŸ³åŒæ­¥
    }
    ///if(currentPage > 1){ currentPage--; renderPage(currentPage); }
    console.log("â®ï¸", currentPage, currentPage-1);
    goToPage(currentPage - 1);
    
    if(lines.length===0) return;
    currentIndex = (currentIndex -1 + lines.length) % lines.length;
    txt.value = lines[currentIndex];
}
function contrlStop() { 
    console.log("â¸ï¸");
    if('speechSynthesis' in window){
      if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
    } else {
      ///alert('ç€è¦½å™¨ä¸æ”¯æ´ Web Speech API');
    }
}
function contrlPlay() {
    console.log("â–¶ï¸");
    let text = txt.value.trim();
    if(!text && pdfDoc){
      ///alert('è«‹å…ˆé¸æ“‡æ–‡å­—æˆ–è¼¸å…¥è¦è®€çš„æ–‡å­—ã€‚');
      return;
    }
    if('speechSynthesis' in window){
      const voice1 = voices[parseInt(document.getElementById('voiceSelect1').value)];
      const voice2 = voices[parseInt(document.getElementById('voiceSelect2').value)];

      if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
      let lang = 1.0; if (currentPage % 2 === 0) { lang = voice2.lang; } else { lang = voice1.lang; }
      let pitch = 1.0; if (currentPage % 2 === 0) { pitch = 0.8; } else { pitch = 1.3; }
      let rate = 1.0; if (currentPage % 2 === 0) { rate = 0.9; } else { rate = 1.2; }
      let volume = 1.0; if (currentPage % 2 === 0) { volume = 0.7; } else { volume = 1.0; }
      
      const voice = voices[parseInt(voiceSelect.value)];  ///???
      ///currentUtter = new SpeechSynthesisUtterance(text);
      const msg = new window.SpeechSynthesisUtterance();
      msg.rate = document.getElementById('rateSlider').value || 2;
      msg.text = text.split('â–¶ï¸')[1];  // text;
      msg.lang = lang;           // èªè¨€ä»£ç¢¼
      ///msg.volume = volume;              // éŸ³é‡ 0~1
      ///msg.pitch = pitch;                // éŸ³é«˜ 0~2
      ///msg.voice = voice;

      ///const voice = voices[voiceSelect.value];  ///???
      ///const voice = voices[parseInt(voiceSelect.value)];  ///???
      ///if (voice) { msg.voice = voice; }  ///???

      ///console.log(new Date().toLocaleString(), voice);                   // ä¸å¯åˆ—èˆ‰ï¼Œç„¡æ³•é€™æ¨£é¡¯ç¤º***
      ///console.log(new Date().toLocaleString(), JSON.stringify(voice));   // ä¸å¯åˆ—èˆ‰ï¼Œç„¡æ³•é€™æ¨£é¡¯ç¤º***
      console.log(new Date().toLocaleString(),   {
        name: name,  ///voice.name,
        lang: lang,  ///voice.lang,
        ///voiceURI: voice.voiceURI,
        ///localService: voice.localService,
        ///default: voice.default
      });

      msg.onend = ()=> console.log(new Date().toLocaleString(), 'æ’­æ”¾çµæŸ');
      msg.onerror = e=> console.error(new Date().toLocaleString(), 'æ’­æ”¾éŒ¯èª¤', e);
      window.speechSynthesis.speak(msg);
    } else {
      ///alert('ç€è¦½å™¨ä¸æ”¯æ´ Web Speech API');
    }
}

// éµç›¤æ§åˆ¶
window.addEventListener('keydown', e => {
  ///if (e.code === 'Space') {  }
  if (e.ctrlKey) { 
    ///contrlStop(); 
  }
  if (e.key === 'ArrowRight') {
    contrlRight();
  }
  if (e.key === 'ArrowLeft') {
    contrlLeft();
  }
  if (e.key === ' ') { 
    ///contrlPlay();
  }
  ///updateCarousel();
  if (e.key === 'ArrowUp') {
    contrlPlay();
  }
  if (e.key === 'ArrowDown') {
    contrlStop(); 
  }
});

// æŒ‰éˆ•æ§åˆ¶
const _playBtn = document.getElementById('speakBtn');
const _stopBtn = document.getElementById('stopBtn');
const _prevBtn = document.getElementById('prevAllBtn');
const _nextBtn = document.getElementById('nextAllBtn');
_playBtn.addEventListener('click', ()=>{ contrlPlay(); });
_stopBtn.addEventListener('click', ()=>{ contrlStop(); });
_prevBtn.addEventListener('click', ()=>{ contrlLeft(); });
_nextBtn.addEventListener('click', ()=>{ contrlRight(); });

// é¼ æ¨™æ§åˆ¶
function touchLog(e, touchname) {
    for (let i = 0; i < e.touches.length; i++) {
        ///const touch = e.changedTouches[i];   // å‰›é›¢é–‹çš„æ‰‹æŒ‡
        const touch = e.touches[i]; // è¢å¹•ä¸Šå‰©ä¸‹çš„æ‰‹æŒ‡
        console.log(`${touchname} * ${i}: (${touch.clientX}, ${touch.clientY})`);
    }
}
document.querySelectorAll("canvas").forEach(canvas => {
    let startX = 0;
    let startY = 0;
    let isPointerDown = false;
    let longPressTimer = null;
    let longPressTriggered = false;
    console.log("â®ï¸â­ï¸â–¶ï¸â¸ï¸");

    canvas.addEventListener('pointermove', e => {
      // å¦‚æœç§»å‹•å¤ªå¤šå°±å–æ¶ˆé•·æŒ‰
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      if(Math.abs(dx) > 10 || Math.abs(dy) > 10){
        clearTimeout(longPressTimer);
      }
    });
    
    canvas.addEventListener('touchstart', e => console.log('touchstart'));
    canvas.addEventListener('touchend', e => console.log('touchend'));
    ///canvas.addEventListener('touchmove', (e) => console.log('touchmove'));
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault(); // é˜»æ­¢é é¢æ»¾å‹•
        touchLog(e, "touchmove");
    });



    ///canvas.addEventListener('pointerdown', e => console.log('pointerdown'));
    ///canvas.addEventListener('pointerup', e => console.log('pointerup'));
    ///canvas.addEventListener('pointermove', e => console.log('pointermove'));

    
    canvas.addEventListener('pointerup', e => {
      canvas.releasePointerCapture(e.pointerId); // é‡‹æ”¾æŒ‡æ¨™
      isPointerDown = false;
      ///longPressTriggered = false;
      console.log(new Date().toLocaleString(), 'pointerup and releasePointerCapture');
      console.log(e.clientX, e.clientY);

      clearTimeout(longPressTimer);
    });

    canvas.addEventListener('pointerdown', e => {
      canvas.setPointerCapture(e.pointerId); // é–å®šæŒ‡æ¨™
      isPointerDown = true;
      longPressTriggered = false;
      console.log(new Date().toLocaleString(), 'pointerup and setPointerCapture');
      console.log(e.clientX, e.clientY);

      clearTimeout(longPressTimer);

      longPressTimer = setTimeout(() => {
        console.log("longPressTimer 1");
        contrlPlay();///contrlLongPress();
        ///isPointerDown = null;  // éå¿…è¦ä¸å•Ÿç”¨æ­¤è¡Œ
        ///longPressTriggered = true;  // éå¿…è¦ä¸å•Ÿç”¨æ­¤è¡Œ
      }, 500); 

      startX = e.clientX;
      startY = e.clientY;

    });

    canvas.addEventListener('pointermove', e => {
      if(!isPointerDown) return; // å¿…é ˆæŒ‰ä½
      ///if(!longPressTriggered) return;

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      const absX = Math.abs(dx);
      const absY = Math.abs(dy);
      ///const threshold = 10; // é¿å…è¼•å¾®æŠ–å‹•è¢«åˆ¤æ–·ç‚ºæ»‘å‹•
      ///const threshold = 50; // æ»‘å‹•éœ€è¦çš„æœ€å°è·é›¢
      const threshold = canvas.clientWidth * 0.05; // 5% çš„ç•«å¸ƒå¯¬åº¦

      // å¦‚æœæŒ‰è‘—æ™‚é–“å¤ é•·
      if (longPressTriggered) {
        // å¦‚æœåªæœ‰å°‘é‡ç§»å‹•
        if(Math.abs(dx) > 10 || Math.abs(dy) > 10) {  }

        ///clearTimeout(longPressTimer);  // å·²è§¸ç™¼ï¼å†å‘¼å« clearTimeout ä¹Ÿæ²’æœ‰ä½œç”¨äº†ï¼
        
        console.log("longPressTimer 3");
        contrlPlay();///contrlLongPress();
        ///isPointerDown = false;
        ///longPressTriggered = false;
        return;  // è‹¥å·²ç¶“è§¸ç™¼é•·æŒ‰ï¼Œä¸å†åˆ¤å®šæ»‘å‹•æˆ–é»æ“Š
      }

      ///isPointerDown = false;  // ä¸å¯å•Ÿç”¨æ­¤è¡Œï¼Ÿå°ï¼

      // æ°´å¹³æ»‘å‹•
      if(absX > absY && absX > threshold){
        if(dx > 0){
          console.log("å‘å³æ»‘å‹•", dx);contrlLeft();
          isPointerDown = false;
          longPressTriggered = false;
          return;
        } else {
          console.log("å‘å·¦æ»‘å‹•", dx);contrlRight();
          isPointerDown = false;
          longPressTriggered = false;
          return;
        }
      }

      // å‚ç›´æ»‘å‹•
      else if(absY > absX && absY > threshold){
        if(dy > 0){
          console.log("å‘ä¸‹æ»‘å‹•", dy);///contrlPlay();
          isPointerDown = false;
          longPressTriggered = false;
          return;
        } else {
          console.log("å‘ä¸Šæ»‘å‹•", dy);///contrlPlay();
          isPointerDown = false;
          longPressTriggered = false;
          return;
        }
      }
    });
});


document.getElementById('fullscreenBtn').addEventListener('click', () => {
  const canvas = document.getElementById('pdfCanvas');
  if (!document.fullscreenElement) { canvas.style.background = "black"; }
  else { canvas.style.background = "transparent"; }

  if (canvas.requestFullscreen) {
    canvas.requestFullscreen();
  } else if (canvas.webkitRequestFullscreen) { /* Safari */
    canvas.webkitRequestFullscreen();
  } else if (canvas.msRequestFullscreen) { /* IE/Edge */
    canvas.msRequestFullscreen();
  }
});
/*
document.querySelectorAll("canvas").forEach(canvas => {  // è«–å·¡ 
  canvas.addEventListener("click", async () => {
    // è‹¥å°šæœªé€²å…¥å…¨è¢å¹• â†’ è«‹æ±‚å…¨è¢å¹•
    if (!document.fullscreenElement) {
      try {
        canvas.style.background = "white"; // â† é€²å…¥å…¨è¢å¹•æ™‚å¥—ç”¨ç™½è‰²èƒŒæ™¯

        await canvas.requestFullscreen();
        // å¼·åˆ¶æ©«å‘é¡¯ç¤ºï¼ˆæ”¯æ´çš„ç€è¦½å™¨æ‰æœ‰æ•ˆï¼‰
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock("landscape").catch(() => {});
        }
      } catch (e) {
        console.log(new Date().toLocaleString(), e);
      }
    } else {
      // è‹¥å·²åœ¨å…¨è¢å¹• â†’ é€€å‡º
      ///document.exitFullscreen();  ///!!!
      ///canvas.style.background = "transparent"; // â† é€€å‡ºå¾Œæ¢å¾©
      ///downloadPNG(canvas);
    }
  });
}); */
</script>


<script>
/* --- TXT åŠŸèƒ½ --- */
const txt = document.getElementById('txt');
const fileInputTxt = document.getElementById('fileInputTxt');
const prevTxtBtn = document.getElementById('prevAllBtn');  ///prevTxtBtn
const nextTxtBtn = document.getElementById('nextAllBtn');  ///nextTxtBtn

let lines = [];
let currentIndex = 0;

// è®€å– TXT
fileInputTxt.addEventListener('change', e=>{

  const file = e.target.files[0];
  ///if(!file) return;
  if (!e.target.files || e.target.files.length === 0) { console.log("file0");window.open("https://cospeaking.nins.cc/inputs/example.txt", "_blank", "noopener,noreferrer");return; }
  if (file.type !== 'text/plain') { setTimeout(() => { window.open("https://cospeaking.nins.cc/inputs/example.txt", "_blank", "noopener,noreferrer"); }, 100);return;  }
  
  document.getElementById('fileInputTxtRow').style.display = "none";
  document.getElementById('switchinputBtn').disabled  = false;  // å–æ¶ˆç¦ç”¨å…ƒç´ 

  const reader = new FileReader();
  reader.onload = (event)=>{
    ///lines = event.target.result.split(/\r?\n/).filter(line=>line.trim()!=='');
    lines = event.target.result.split(/\r?\n/).filter(line=>line.trim()!=='' && line.includes('â–¶ï¸'));
    currentIndex = 0;
    txt.value = lines[currentIndex] || '';
    ///txt.value = lines[currentIndex].replace(/^\[\d{4}\]\s*/, "") || '';  ///0000~9999
    ///txt.value = text.split('â–¶ï¸')[1];  // ä¿ç•™ emoji ä¹‹å¾Œçš„å…§å®¹

  };
  reader.readAsText(file);
});

/*
prevTxtBtn.addEventListener('click', ()=>{
  if(lines.length===0) return;
  currentIndex = (currentIndex -1 + lines.length) % lines.length;
  txt.value = lines[currentIndex];
});

nextTxtBtn.addEventListener('click', ()=>{
  if(lines.length===0) return;
  currentIndex = (currentIndex +1) % lines.length;
  txt.value = lines[currentIndex];
});  */


</script>


<script>
/* --- PDF åŠŸèƒ½ --- */
const fileInputPdf = document.getElementById('fileInputPdf');
const pdfCanvas = document.getElementById('pdfCanvas');
const pageInfo = document.getElementById('pageInfo');
const prevPdfBtn = document.getElementById('prevAllBtn');  ///prevPdfBtn
const nextPdfBtn = document.getElementById('nextAllBtn');  ///nextPdfBtn

let pdfDoc = null;
let currentPage = 1;
let totalPages = 0;

const renderPage = async (num)=>{
  const page = await pdfDoc.getPage(num);
  const viewport = page.getViewport({ scale: 1.5 });
  pdfCanvas.height = viewport.height;
  pdfCanvas.width = viewport.width;
  const renderCtx = {
    canvasContext: pdfCanvas.getContext('2d'),
    viewport
  };
  await page.render(renderCtx).promise;
  pageInfo.setAttribute("translate", "no");
  pageInfo.textContent = `${num} / ${totalPages}`;
  pageInfo.style.display = "block";
  ///pdfCanvas.style.border = "1px solid black";
  ///pageInfo.style.display = "none";
  pdfCanvas.style.border = "1px solid #cdcdcd";
  pdfCanvas.style.display = "block";
};

fileInputPdf.addEventListener('change', e=>{

  const file = e.target.files[0];
  ///if(!file) return;
  if (!e.target.files || e.target.files.length === 0) { console.log("file0");window.open("https://cospeaking.nins.cc/inputs/example.pdf", "_blank", "noopener,noreferrer");return; }
  if (file.type !== 'application/pdf') { setTimeout(() => { window.open("https://cospeaking.nins.cc/inputs/example.pdf", "_blank", "noopener,noreferrer"); }, 100);return;  }
  
  document.getElementById('fileInputPdfRow').style.display = "none";
  document.getElementById('fullscreenBtn').disabled  = false;  // å–æ¶ˆç¦ç”¨å…ƒç´ 

  const reader = new FileReader();
  reader.onload = async (event)=>{
    const typedarray = new Uint8Array(event.target.result);
    pdfDoc = await pdfjsLib.getDocument({data: typedarray}).promise;
    totalPages = pdfDoc.numPages;
    currentPage = 1;
    renderPage(currentPage);
  };
  reader.readAsArrayBuffer(file);
});

/*
prevPdfBtn.addEventListener('click', ()=>{
  if(!pdfDoc) return;
  if(currentPage > 1){ currentPage--; renderPage(currentPage); }
});

nextPdfBtn.addEventListener('click', ()=>{
  if(!pdfDoc) return;
  if(currentPage < totalPages){ currentPage++; renderPage(currentPage); }
}); */

/*
let renderTimer = null; // é˜²æŠ–è¨ˆæ™‚å™¨

const debouncedRenderPage = (num) => {
  if (renderTimer) clearTimeout(renderTimer);
  renderTimer = setTimeout(() => {
    renderPage(num);
  }, 500); // 500ms ç­‰å¾…ç©©å®šå¾Œæ¸²æŸ“
};

// æ”¹é€ ä¸Šä¸€é ã€ä¸‹ä¸€é æŒ‰éˆ•äº‹ä»¶
prevPdfBtn.addEventListener('click', ()=>{
  if(!pdfDoc) return;
  if(currentPage > 1){ 
    currentPage--; 
    debouncedRenderPage(currentPage);
  }
});

nextPdfBtn.addEventListener('click', ()=>{
  if(!pdfDoc) return;
  if(currentPage < totalPages){ 
    currentPage++; 
    debouncedRenderPage(currentPage);
  }
}); */

let renderTimer = null;   // é˜²æŠ–è¨ˆæ™‚å™¨
let currentRenderTask = null; // è¿½è¹¤ç•¶å‰æ¸²æŸ“ä»»å‹™

const renderPageWithCancel = async (num) => {
  if (!pdfDoc) return;

  // å¦‚æœä¸Šä¸€å€‹æ¸²æŸ“é‚„åœ¨é€²è¡Œï¼Œå…ˆå–æ¶ˆ
  if (currentRenderTask) {
    ///currentRenderTask.cancel();
    try {
      await currentRenderTask.cancel();  // ç­‰å¾…ç•°éƒ¨å®Œæˆ
    } catch (err) {
      if (err?.name !== 'RenderingCancelledException') console.error(err);
    }
    currentRenderTask = null;
  }

  const page = await pdfDoc.getPage(num);
  const viewport = page.getViewport({ scale: 1.5 });
  pdfCanvas.height = viewport.height;
  pdfCanvas.width = viewport.width;

  const renderCtx = {
    canvasContext: pdfCanvas.getContext('2d'),
    viewport
  };


  // é–‹å§‹æ¸²æŸ“
  currentRenderTask = page.render(renderCtx);
  try {
    await currentRenderTask.promise;
  } catch (err) {
    if (err?.name !== 'RenderingCancelledException') console.error(err);
  } finally {
    currentRenderTask = null;
  }
};

const debouncedRenderPage = (num) => {
  if (renderTimer) clearTimeout(renderTimer);
  renderTimer = setTimeout(() => {
    renderPageWithCancel(num);
  }, 520);  // 100~500ms
};

// å°‡é ç¢¼æ›´æ–°ç¨ç«‹
const goToPage = (num) => {
  if (!pdfDoc) return;
  if (num < 1) num = 1;
  if (num > totalPages) num = totalPages;
  currentPage = num;

  // é ç¢¼å…ˆæ›´æ–°
  pageInfo.setAttribute("translate", "no");
  pageInfo.textContent = `${currentPage} / ${totalPages}`;
  pageInfo.style.display = "block";

  // å†æ¸²æŸ“
  debouncedRenderPage(currentPage);
};

/*
// ä¸Šä¸€é 
prevPdfBtn.addEventListener('click', () => goToPage(currentPage - 1));
// ä¸‹ä¸€é 
nextPdfBtn.addEventListener('click', () => goToPage(currentPage + 1)); */
</script>


<script>
/* --- TTS é¸æ“‡ --- */
const voiceSelect = document.getElementById('voiceSelect');
let voices = [];

function languageScript(tag) {
  return tag.split('-').slice(0, 2).join('-');
}
function languageRegion(tag) {
  const match = tag.match(/^([^-]+)-([^-]+)$/); // å˜—è©¦åŒ¹é…å…©æ®µ
  if (match) return match[1] + '-' + match[2];
  
  // å¦‚æœæœ‰ä¸‰æ®µä»¥ä¸Šï¼Œå–ç¬¬ä¸€æ®µ + æœ€å¾Œä¸€æ®µ
  const parts = tag.split('-');
  if (parts.length >= 2) return parts[0] + '-' + parts[parts.length - 1];

  return tag; // åªæœ‰èªè¨€
}

function addOptionToSelects(voice, selects, index) {
  selects.forEach(sel => {
    const option = document.createElement('option');
    option.value = index;
    option.textContent = `${voice.name} (${voice.lang})`;
    sel.appendChild(option);
  });
}

const selectElements = [
  document.getElementById('voiceSelect'),
  document.getElementById('voiceSelect1'),
  document.getElementById('voiceSelect2')
];

function loadVoices() {
  voices = speechSynthesis.getVoices();
  voiceSelect.innerHTML = '';
  voices.forEach((voice, i) => addOptionToSelects(voice, selectElements, i));
  /*
  voices.forEach((voice, i) => {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${voice.name} (${voice.lang})`;
    voiceSelect.appendChild(option);
  }); */
  
  // è¨­å®šé è¨­èªéŸ³
  const language = languageRegion(navigator.language || navigator.userLanguage || "en-US");  // é–±è®€æ¯èª
  const defaultVoice = voices.find(v => v.lang.startsWith( new URL(window.location.href).searchParams.get("lang")||language )) || 
                       ///voices.find(v => v.lang === language) || 
                       voices.find(v => v.lang.startsWith( language.replace(/_/g, "-") )) || // zh-TW
                       voices.find(v => v.lang.startsWith( language.replace(/-/g, "_") )) || // zh_TW
                       voices.find(v => v.lang.startsWith( language.slice(0, 2) ));
  
  if (defaultVoice) {
    const index = voices.indexOf(defaultVoice);
    voiceSelect.value = index;
    document.getElementById('voiceSelect1').value = index;
    document.getElementById('voiceSelect2').value = index;
  }
}

speechSynthesis.onvoiceschanged = loadVoices;  // æœ‰äº›ç€è¦½å™¨èªéŸ³éœ€è¦ async è¼‰å…¥
loadVoices();  // é å…ˆè¼‰ä¸€æ¬¡


/* --- TTS æ’­æ”¾ --- */
const speakBtn = document.getElementById('speakBtn');
const stopBtn = document.getElementById('stopBtn');
let currentUtter = null;

/*
speakBtn.addEventListener('click', ()=>{
  if (true) {
    let text = txt.value.trim();
    if(!text && pdfDoc){
      ///alert('è«‹å…ˆé¸æ“‡æ–‡å­—æˆ–è¼¸å…¥è¦è®€çš„æ–‡å­—ã€‚');
      return;
    }
    if('speechSynthesis' in window){
      if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
      
      const voice = voices[parseInt(voiceSelect.value)];  ///???
      ///currentUtter = new SpeechSynthesisUtterance(text);
      const msg = new window.SpeechSynthesisUtterance();
      msg.text = text;
      msg.lang = voice.lang;           // èªè¨€ä»£ç¢¼
      msg.rate = document.getElementById('rateSlider').value || 2;
      ///msg.volume = 1;                // éŸ³é‡ 0~1
      ///msg.pitch = 1;                 // éŸ³é«˜ 0~2
      ///msg.voice = voice;

      ///const voice = voices[voiceSelect.value];  ///???
      ///const voice = voices[parseInt(voiceSelect.value)];  ///???
      ///if (voice) { msg.voice = voice; }  ///???

      ///console.log(new Date().toLocaleString(), voice);                   // ä¸å¯åˆ—èˆ‰ï¼Œç„¡æ³•é€™æ¨£é¡¯ç¤º***
      ///console.log(new Date().toLocaleString(), JSON.stringify(voice));   // ä¸å¯åˆ—èˆ‰ï¼Œç„¡æ³•é€™æ¨£é¡¯ç¤º***
      console.log(new Date().toLocaleString(),   {
        name: voice.name,
        lang: voice.lang,
        ///voiceURI: voice.voiceURI,
        ///localService: voice.localService,
        ///default: voice.default
      });

      msg.onend = ()=> console.log(new Date().toLocaleString(), 'æ’­æ”¾çµæŸ');
      msg.onerror = e=> console.error(new Date().toLocaleString(), 'æ’­æ”¾éŒ¯èª¤', e);
      window.speechSynthesis.speak(msg);
    } else {
      ///alert('ç€è¦½å™¨ä¸æ”¯æ´ Web Speech API');
    }
  }
});

stopBtn.addEventListener('click', ()=>{
  if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
}); */
</script>
    <!-- æ”¾ç½®ä½ åŸæœ‰çš„å¸ƒå±€ -->







    <script type="text/javascript">  // google.js
      // GOOGLE TRANSLATE
      // è‡ªå‹•ç¿»è­¯***
      ///document.cookie = "googtrans=/en/zh-TW; path=/";
      ///location.reload();
    
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'en',  ///'en', æ”¹ç‚ºæ ¹æ“šä¸­é–“èªè¨€(ilang) æˆ– é é¢èªè¨€(locale)  ///é¼“å‹µè¼¸å…¥ä¸­é–“èªè¨€ï¼Œç¿»è­¯å¿…å®šå¯ä»¥é¡¯ç¤ºè‹±æ–‡ã€‚
          includedLanguages: '',  ///zh-TW,ja,ko,en,hi,zh-CN
          autoDisplay: false,
          ///layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
      }
      
    
      function autoTranslate(lang) {
        const tryTranslate = () => {
          const combo = document.querySelector('.goog-te-combo');
          if (combo) {
            combo.value = lang;
            combo.dispatchEvent(new Event('change'));
          } else {
            setTimeout(tryTranslate, 300); // éè¿´æª¢æŸ¥
          }
        };
        tryTranslate();
      }
    
      window.addEventListener('load', () => {
        setTimeout(() => {
          const tlang = navigator.language || navigator.userLanguage || "en-US";
          autoTranslate(tlang);
          
          ///document.getElementById(":1.container").style.display = "";
        }, 1500);
      });
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    
</body>
</html>
